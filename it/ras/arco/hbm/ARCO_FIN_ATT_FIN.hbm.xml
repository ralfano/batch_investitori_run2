<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>

 <!-- TABELLA ATT_FIN -->  
 <class name="it.ras.arco.bean.FinAttivitaFinanziaria" batch-size="50"
  	table="FIN_ATT_FIN" lazy="true" where="GSTD_ESIST_B='S'" 
  	select-before-update="true" dynamic-update="true" optimistic-lock="dirty"
  	>
  
  <id name="attivitaFinId" column="ATTIVITA_FIN_ID" type="integer">
   <generator class="sequence">
    <param name="sequence">FIN_ATT_FIN_SEQ</param>
   </generator>
  </id>
  
  <property name="codiceTit" type="string" column="CODICE_TIT" length="12"/>
  <property name="codiceCad" type="string" column="CODICE_CAD" length="12"/>
  <property name="codiceBanca" type="string" column="CODICE_BANCA_I" length="20"/>
  <property name="tipoF" type="string" column="TIPO_F" length="20"/>
  <property name="descrizione" type="string" column="DESCRIZIONE_S" length="100"/>
  <property name="descrizBreve" type="string" column="DESCRIZ_BREVE_S" length="20"/>
  <property name="isin" type="string" column="ISIN_S" length="12"/>
  <property name="classe" type="string" column="CLASSE_T" length="1"/>
  <property name="codTariffa" type="string" column="COD_TARIFFA" length="9"/>
  <property name="tariffa" type="string" column="TARIFFA_T" length="18"/>
  <property name="divisaQuot" type="string" column="DIVISA_QUOT_T" length="3"/>
  <property name="dataInizioComm" type="timestamp" column="DATA_INIZIO_COMM"/>
  <property name="dataPrimoRegolamento" type="timestamp" column="DATA_PRIMO_REG"/>
  <property name="dataFineRegolamento" type="timestamp" column="DATA_FINE_REG"/>
  <property name="dataFineComm" type="timestamp" column="DATA_FINE_COMM"/>
  <property name="dataUltRilMgt" type="timestamp" column="DATA_ULT_RIL_MGT_D"/>
  <property name="dataPrcRilMgt" type="timestamp" column="DATA_PRC_RIL_MGT_D"/>
  <property name="ultimoMeseElab" type="timestamp" column="ULTIMO_MESE_ELAB_D"/>
  <property name="dataInizio" type="timestamp" column="DATA_INIZIO_D"/>
  <property name="dataFine" type="timestamp" column="DATA_FINE_D"/>
  <property name="trattato" type="string" column="TRATTATO_B" length="1"/>
  <property name="nomeFile" type="string" column="NOME_FILE_S" length="100"/>
  <property name="var" type="string" column="VAR_S" length="10"/>
  <property name="livello" type="string" column="LIVELLO_T" length="3"/>
  <property name="paeseEmissione" type="string" column="PAESE_EMISSIONE_T" length="3"/>
  <property name="benchmark" type="string" column="BENCHMARK" length="100"/>
  <property name="ctAssogestioni" type="string" column="CT_ASSOGESTIONI" length="40"/>
  <property name="classeRischio" type="integer" column="CLASSE_RISCHIO" length="3"/>
  <property name="visibilitaCP" type="string" column="VISIBILITA_CP" length="1"/>
  <property name="codMarket" type="string" column="COD_MARKET" length="4"/>
  <property name="dataUltimoProspetto" type="timestamp" column="DATA_ULTIMO_PROSPETTO" length="4"/>
  <property name="note" type="string" column="NOTE" length="50"/>
  <property name="commGestione" type="integer" column="COMM_GESTIONE" length="3"/>
  <property name="retroCommissioni" type="string" column="RETRO_COMMISSIONI" length="64"/>
  <property name="divisaComp" type="string" column="DIVISA_COMP" length="3"/>
  <!-- CAMPO AGGIUNTO PER GESTIONE CALENDARIO -->
  <property name="codiceCalendario" type="string" column="CODICE_CALENDARIO_T" length="3"/>
  <property name="gestioneArco" type="string" column="GEST_ARCO_FLAG" length="1" />
  
   
  <!--	CAMPI AGGIUNTI DA MAF	    -->  
  <property name="sottotipo" type="string" column="SOTTOTIPO_F" length="64"/>
  <property name="simboloPiazza" type="string" column="COD_ITEM_MARKET" length="64"/>
  <property name="settoreIndustriale" type="string" column="COD_SETTORE" length="64"/>
  
  <!--	CAMPI AGGIUNTI DA MAF	-->    
  <property name="censitaOnLine" type="string" column="ON_LINE_B" length="1"/>


  <!--	Decodifiche verso FABBRICA, ANT e MAF. Replica dei valori in codestable.	-->    
  <property name="codAttFinExt" type="string" column="COD_ATT_FIN_EXT_S" 	length="64"/>
  <property name="codiceAnt" 	type="string" column="CODICE_ANT_S" 		length="64"/>
  <property name="codiceMaf" 	type="string" column="CODICE_MAF" 			length="64"/>
  

  <property name="descrizioneCad" 	type="string" column="DESCRIZIONE_CAD_S"   length="100"/>
  <property name="compartoCad" 	type="string" column="COMPARTO_CAD_S"   length="100"/>
  <property name="codiceTitoloCad" 	type="string" column="CODICE_TITOLO_CAD_S"   length="100"/>

  
  
    <!-- 
		RELAZIONE CON FIN_PREZZO 
			lock,none
	-->
  <set name="prezzo" where ="GSTD_ESIST_B='S'" cascade="save-update,lock" 
		  inverse="true" lazy="true" batch-size="50"
		  >
   <key column="ATTIVITA_FIN_ID"/>
   <one-to-many class="it.ras.arco.bean.FinPrezzo" not-found="ignore" />
  </set>
    
  
   <!-- RELAZIONE CON FIN_ULT_PREZZO  -->
  <many-to-one name="ultPrezzo" lazy="false"
  	 class="it.ras.arco.bean.FinUltPrezzo" 
  	 column="ULT_PREZZO_ID" unique="true"
  	 insert="true" update="true"
  	 cascade="save-update,lock" 
  	 not-null="false" not-found="ignore"
  	 fetch="join"
  	 />





  <!-- RELAZIONE CON FIN_PRODOTTO_LINEA (nuova versione) -->
  <set 	name="prodotto" cascade="save-update,lock" 
  	outer-join="false"
  	where="GSTD_ESIST_B='S'"
	inverse="true"
	lazy="true"
	batch-size="50"
  	>
   <key column="ATTIVITA_FIN_ID"/>
   <one-to-many class="it.ras.arco.bean.FinProdottoLinea" not-found="ignore" />
  </set>

   
  <!-- RELAZIONE CON LA FIN_PRODOTTO -->
<!--
  <set name="prodotto" table="FIN_PRODOTTO_LINEA" inverse="true" lazy="true"
   cascade="all" where="GSTD_ESIST_B='S'" outer-join="false">
   <key column="ATTIVITA_FIN_ID"/>
   <composite-element class="it.ras.arco.bean.FinProdottoLinea">
    <parent name="attFin"/>
    <many-to-one name="prodotto" lazy="true"
     class="it.ras.arco.bean.FinProdotto"
     column="PRODOTTO_ID" outer-join="false" not-found="ignore" />

	<property name="dataInizio" type="timestamp" column="DATA_INIZIO_D"/>
	<property name="dataFine" type="timestamp" column="DATA_FINE_D"/>
	
	<property name="userUltimaModifica" type="string" column="GSTD_ULT_USER_S" length="40"/>
	<property name="proceduraUltimaModifica" type="string" column="GSTD_ULT_PROC_S" length="40"/>
	<property name="dataUltimaModifica" type="timestamp" column="GSTD_ULT_MOD_D"/>
	<property name="dataInserimento" type="timestamp" column="GSTD_INSE_D"/>
	<property name="flagEsistenza" type="string" column="GSTD_ESIST_B" length="1"/>
	<property name="utenteInserimento" type="string" column="GSTD_USER_INS_S" length="40"/>
	<property name="tipoUltimaModifica" type="string" column="GSTD_TIPO_MOD_B" length="1"/>

   </composite-element>
  </set> 
-->




  <!-- RELAZIONE CON FIN_ENTITA_PARAMETRO -->
  <set 	name="listaParametri" cascade="save-update,lock" 
  		lazy="true"  
  		where="GSTD_ESIST_B='S' and DATA_FINE_D >= sysdate"
  		sort="it.ras.arco.bean.ParameterComparator"
  		inverse="true"
  		batch-size="50"
  		>
	<key column="ATTIVITA_FIN_ID"/>
	<one-to-many class="it.ras.arco.bean.FinEntitaParametro" not-found="ignore" />
  </set>



	<!-- RELAZIONE CON FIN_ORDINE 	 -->
  <set 	name="ordine" cascade="save-update,lock"
  		where="GSTD_ESIST_B='S'"
  		inverse="true"
  		lazy="true"
  		>
	<key column="ATTIVITA_FIN_ID"/>
	<one-to-many class="it.ras.arco.bean.FinOrdine" not-found="ignore"/>
  </set>
  
<!--
	 <one-to-one name="ordine" 
	  	 class="it.ras.arco.bean.FinOrdine"
	  	 lazy="true"
  	 />
-->



  <!-- RELAZIONE CON FIN_ATT_FIN_DETTAGLIO -->
  <set 	name="dettaglio" cascade="save-update,lock"
  		where="GSTD_ESIST_B='S'"
  		inverse="true"
  		lazy="true"
  		>
	<key column="ATTIVITA_FIN_ID"/>
	<one-to-many class="it.ras.arco.bean.FinAttFinDettaglio" not-found="ignore" />
  </set>




	<!-- RELAZIONE CON FIN_BENCHMARK -->
	<set name="listaBenchmark" 
		cascade="lock" 
		inverse="true" 
		where ="GSTD_ESIST_B='S'"
		lazy="true">
		
		<key column="ATTIVITA_FIN_ID"/>
		<one-to-many class="it.ras.arco.bean.FinBenchmark" not-found="ignore" />
	</set>


	<!-- RELAZIONE CON FIN_CEDOLE_DIVIDENDI -->
	<set name="listaCedoleDividendi" 
		cascade="lock" 
		inverse="true" 
		where ="GSTD_ESIST_B='S'"
		lazy="true">
		
		<key column="ATTIVITA_FIN_ID"/>
		<one-to-many class="it.ras.arco.bean.FinCedoleDividendi" not-found="ignore" />
	</set>


	<!-- RELAZIONE CON FIN_RATING -->
	<set name="listaRating" 
		cascade="lock" 
		inverse="true" 
		where ="GSTD_ESIST_B='S'"
		lazy="true">
		
		<key column="ATTIVITA_FIN_ID"/>
		<one-to-many class="it.ras.arco.bean.FinRating" not-found="ignore" />
	</set>


	<!-- RELAZIONE CON FIN_PORTAFOGLIO_FONDI -->
	<set name="listaPortafoglioFondi" 
		cascade="lock" 
		inverse="true" 
		where ="GSTD_ESIST_B='S'"
		lazy="true">
		
		<key column="ATTIVITA_FIN_ID"/>
		<one-to-many class="it.ras.arco.bean.FinPortafoglioFondi" not-found="ignore" />
	</set>


	<!-- RELAZIONE CON FIN_RENDIMENTO -->
	<set name="listaRendimento" 
		cascade="lock" 
		inverse="true" 
		where ="GSTD_ESIST_B='S'"
		lazy="true">
		
		<key column="ATTIVITA_FIN_ID"/>
		<one-to-many class="it.ras.arco.bean.FinRendimento" not-found="ignore" />
	</set>


	<!-- RELAZIONE CON FIN_COMMISSIONI -->
	<set name="listaCommissioni" 
		cascade="lock" 
		inverse="true" 
		where ="GSTD_ESIST_B='S'"
		lazy="true">
		
		<key column="ATTIVITA_FIN_ID"/>
		<one-to-many class="it.ras.arco.bean.FinCommissioni" not-found="ignore" />
	</set>

   <!-- RELAZIONE CON WP_POSIZIONE -->
   <!--
  <set name="wpposizione" 
       where ="GSTD_ESIST_B='S'" 
       cascade="@ATT_FIN-wpposizione.cascade@" 
	   inverse="@ATT_FIN-wpposizione.inverse@" 
	   lazy="@ATT_FIN-wpposizione.lazy@" 
	  >
   <key column="ATTIVITA_FIN_ID"/>
   <one-to-many class="@WP_POSIZIONE.class@" not-found="ignore" />
  </set>
  -->

  <!--
  	***********************
  	  CAMPI STANDARD
  	***********************
  -->
  <property name="userUltimaModifica" type="string" column="GSTD_ULT_USER_S" length="40"/>
  <property name="proceduraUltimaModifica" type="string" column="GSTD_ULT_PROC_S" length="40"/>
  <property name="dataUltimaModifica" type="timestamp" column="GSTD_ULT_MOD_D"/>
  <property name="dataInserimento" type="timestamp" column="GSTD_INSE_D"/>
  <property name="flagEsistenza" type="string" column="GSTD_ESIST_B" length="1"/>
  <property name="utenteInserimento" type="string" column="GSTD_USER_INS_S" length="40"/>
  <property name="tipoUltimaModifica" type="string" column="GSTD_TIPO_MOD_B" length="1"/>
  
  <property name="userUltimaModificaSlave" type="string" column="GSTD_ULT_USER_S" length="40" insert="false" update="false"/>
  <property name="proceduraUltimaModificaSlave" type="string" column="GSTD_ULT_PROC_S" length="40" insert="false" update="false"/>
  <property name="dataUltimaModificaSlave" type="timestamp" column="GSTD_ULT_MOD_D" insert="false" update="false"/>
  <property name="tipoUltimaModificaSlave" type="string" column="GSTD_TIPO_MOD_B" length="1" insert="false" update="false"/>
   
  

 </class>
 

 <query name="Ricerca_Att_Fin">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.attivitaFinId = ?</query>
 <query name="GetAttFinByDescDt">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.descrizione = ?</query>
 
 <query name="GetAttFinByIsinCodMarketDivisa">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.divisaComp = ? and  f.isin= ? and f.codMarket= ?  </query>

 <query name="GetAttFinByIsin">from it.ras.arco.bean.FinAttivitaFinanziaria f where   f.isin= ?  </query>
 
 <query name="GetAttFinByIsinDivisaQuot">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.divisaQuot = ? and  f.isin= ?</query>
 <query name="GetAttFinByIsinCodMarketDivisaQuot">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.divisaQuot = ? and  f.isin= ? and f.codMarket= ?  </query>
  
  <query name="GetAttFinByCtit">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.codiceTitoloCad=? order by f.dataUltimaModifica </query>
 
  
  
  
  <!--<query name="GetAttFinByIsinCodMarketListDivisa">from it.ras.arco.bean.FinAttivitaFinanziaria f where f.divisaQuot = ?  and f.codMarket in(?)and f.isin= ?</query> 
 -->
 
 <sql-query name="GetAttFinByIsinCodMarketListDivisa">
 <return alias="attFin" class="it.ras.arco.bean.FinAttivitaFinanziaria"/> 
 select 
 *
 from
 FIN_ATT_FIN attFin
 where 
 attFin.ISIN_S =:isin 
 and
 attFin.DIVISA_QUOT_T =:divisa  
 and
 :market  like  '%-'||attFin.COD_MARKET ||'-%'
 and attFin.GSTD_ESIST_B='S'
</sql-query>
 
</hibernate-mapping>

