<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
 <!-- TABELLA PROTAFOGLIO GP  -->
 <class name="it.ras.arco.bean.FinPortafoglioGP"
  table="FIN_PORTAFOGLIO_GP" where="GSTD_ESIST_B='S'">
  <id name="portafoglioId" column="PORTAFOGLIO_ID" type="integer">
   <generator class="sequence">
    <param name="sequence">FIN_PORTAFOGLIO_GP_SEQ</param>
   </generator>
  </id>
  <property name="contrattoId" type="integer" column="CONTRATTO_ID" insert="false" update="false"/> 
  <property name="tipo" type="string" column="TIPO_T" length="3"/>
  <property name="descTitolo" type="string" column="DESC_TITOLO_S" length="100"/>
  <property name="isin" type="string" column="ISIN_S" length="12"/>
  <property name="categoria" type="string" column="CATEGORIA_T" length="3"/>
  <property name="paeseEmissione" type="string"  column="PAESE_EMISSIONE_T" length="3"/>
  <property name="quantita" type="double" column="QUANTITA_C"/>
  <property name="prezzo" type="double" column="PREZZO_C"/>
  <property name="rateo" type="double" column="RATEO_C"/>
  <property name="ultPrezzo" type="double" column="ULT_PREZZO_C"/>
  <property name="dataUltPrezzo" type="date" column="DATA_ULT_PREZZO_D"/>
  <property name="divisa" type="string" column="DIVISA_T" length="3"/>
  <property name="cambio" type="double" column="CAMBIO_C"/>
  <property name="ctvDivisa" type="double" column="CTV_DIVISA_C"/>
  <property name="ctvEuro" type="double" column="CTV_EURO_C"/>
  <property name="pmcTitolo" type="double" column="PMC_TITOLO_C"/>
  <property name="cmcTitolo" type="double" column="CMC_TITOLO_C"/>
  <property name="percentuale" type="double" column="PERCENTUALE_C"/>

	<!-- Giuseppe.Rigano [GP_INVESTITORI_FASE_2] 29/12/2011 -->
	<property name="categoriaTitolo" type="string" column="CATEGORIA_TITOLO_T"
		length="3" />
	<!-- Il campo ctvDivisa era giÃ  presente in quanto precedentemente veniva 
		valorizzato dal batch dei saldi dividendo il ctvEuro per il cambio -->
  
  <property name="userUltimaModifica" type="string"  column="GSTD_ULT_USER_S" length="20"/>
  <property name="proceduraUltimaModifica" type="string" column="GSTD_ULT_PROC_S" length="20"/>
  <property name="dataUltimaModifica" type="timestamp" column="GSTD_ULT_MOD_D"/>
  <property name="dataInserimento" type="timestamp" column="GSTD_INSE_D"/>
  <property name="flagEsistenza" type="string" column="GSTD_ESIST_B" length="1"/>
  <property name="utenteInserimento" type="string" column="GSTD_USER_INS_S" length="20"/>
  <property name="tipoUltimaModifica" type="string" column="GSTD_TIPO_MOD_B" length="1"/>
  <property name="userUltimaModificaSlave" type="string" column="GSTD_ULT_USER_S" length="40" insert="false" update="false"/>
  <property name="proceduraUltimaModificaSlave" type="string" column="GSTD_ULT_PROC_S" length="40" insert="false" update="false"/>
  <property name="dataUltimaModificaSlave" type="timestamp" column="GSTD_ULT_MOD_D" insert="false" update="false"/>
  <property name="tipoUltimaModificaSlave" type="string" column="GSTD_TIPO_MOD_B" length="1" insert="false" update="false"/>

  <many-to-one name="contratto" class="it.ras.arco.bean.FinContratto" column="CONTRATTO_ID"  cascade="lock" lazy="proxy"  not-found="ignore" /> 

 
 </class>
 <!-- QUERY -->
  
   <query name="FinPortafoglioGP_checkGetPortafoglioGPByCtrID_IsinMD">from it.ras.arco.bean.FinPortafoglioGP c where c.contrattoId = ?
  and c.isin = ?</query>


 <sql-query name="OutboundPortafoglio">
 <return alias="gp" class="it.ras.arco.bean.FinPortafoglioGP"/>
	select {gp.*}  from FIN_PORTAFOGLIO_GP gp
	where  gp.gstd_esist_b='S'
	and gp.DATA_ULT_PREZZO_D in (select max(DATA_ULT_PREZZO_D) from FIN_PORTAFOGLIO_GP where  gstd_esist_b='S')
 </sql-query>




</hibernate-mapping>

